<script src="bootstrap.bundle.min.js"></script>
<script src="feather.min.js"></script>
<script src="Chart.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function(){
        "use strict"
        const selectOption = document.getElementById("select-option")
        const myChart = document.getElementById("myChart")

        feather.replace({ "aria-hidden": "true" })

        const items = JSON.parse('<%- item %>')  
        const keys = Object.keys(items[0]).filter(key => {
            return key === "Total Cases" || key === "Total Deaths" || key === "Total Recovered" || key === "Total Tests" || key === "Population"
        })
        const values = keys.map(key => items[0][key])
        const newValues = values.map(value => {
            if(value === "No Data"){
                return 0
            }
            return Number(value.replace(/,|\+/g, ""))
        })

        const dummyChart = new Chart(myChart, {
            type: "bar",
            data: {
                labels: keys,
                datasets: [{
                    data: newValues,
                    lineTension: 0,
                    backgroundColor: '#007bff',
                    borderColor: '#007bff',
                    borderWidth: 4,
                    pointBackgroundColor: '#007bff'
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                legend: {
                    display: false
                }                
            }
        })

        selectOption.addEventListener("change", e => {
            const value = e.target.value 
            if(value === "select"){
                return 
            } else {                  
                let dataValues = dummyChart.data.datasets[0].data 
                const wasSelected = items.filter(item => item["Country Other"] === value)              
            
                const valuesFromWasSelected = keys.map(key => wasSelected[0][key])      
                const newValuesFromSelectedItem = valuesFromWasSelected.map(value => {
                    if(value === "No Data"){
                        return 0
                    }
                    return Number(value.replace(/,|\+/g, ""))                    
                })
                for(let i = 0; i < dataValues.length; i++){
                    dataValues[i] = newValuesFromSelectedItem[i]
                }
                dummyChart.update()
            }
        })
    })
</script>